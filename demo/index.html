<!DOCTYPE html>
<html>
<head>

<script type="module">

import {load, setup} from '../cjs-loader.js';
setup('../cjs-loader.js');

load('./foo.js').then((foo) => {
  console.info('got foo in Promise', foo);
});
load('./base64.js').then((base64) => {
  console.info('got base64 in Promise', base64);
});

// nb. on the web, we have to refer to index.js directly: we can't get the path of the script after
// it's executing (no redirects allowed)
const packageToLoad = (window.location.hostname === 'localhost' ?
    'handlebars' : 'https://unpkg.com/handlebars@4.0.10/lib/index.js');

load(packageToLoad).then((handlebars) => {
  console.info('handlebars', handlebars);
  const Handlebars = handlebars.create();

  const source = '<p>Hello {{name}}, you have {{name.length}} letters in your name</p>';
  const template = Handlebars.compile(source);
  const out = template({name: 'Sam'});
  encoded.innerHTML = out;
});

</script>

</head>
<body>

<p style="color: red">Note: tested on Chrome 62.</p>

<p>
  If you see a message below (generated by Handlebars), the demo worked.
  Open the Developer Tools to see the network requests being madeâ€”there's about 35 to go, so it's slow on the first load.
</p>

<div id="encoded" style="font-style: italic;"></div>

</body>
</html>
